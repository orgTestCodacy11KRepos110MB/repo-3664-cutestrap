<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Home</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="apple-touch-fullscreen" content="yes">

    <link rel="stylesheet" href="demo.css?CACHEBUST">
  </head>
  <body>
    <a href="./index.html">Back to Home</a>
    <main id="main">
      <h1>
        Documentation: Demo
      </h1>

      <h2>Step 1: Select a Subreddit</h2>
      <reddit-options></reddit-options>

      <h2>Step 2: Select a sort mode</h2>

      <fieldset>
        <legend>Attributes</legend>
        <sort-options></sort-options>
      </fieldset>

      <h2>Step 3: result</h2>
      <div style="display: grid; gap: 10px">
        <fieldset>
          <legend>Input</legend>
          <textarea disabled style="width: 100%; height: 4rem"></textarea>
        </fieldset>
        <fieldset>
          <legend>Output</legend>
          <demoarea></demoarea>
        </fieldset>
      </div>

      <hr/>
      <details>
        <summary>View Code</summary>
        <script type="module" style="display: block;">
import '../js/cutestrap.js?CACHEBUST';

import {
  get,
  set,
  on,
  load
} from '../js/vendor/ion/app.js?CACHEBUST'

set('demo', { content: '', sort: 'hot', r: 'all', version: -1 })
const version = () => get('demo').version
const props = () => get('demo')
const code = () => {
  const { r, sort } = props()
  const attributes = `r="${r}" ${ sort ? `sort="${sort}"` : '' }`

  return `<cute-reddit ${attributes}></cute-reddit>`;
}

const sortButtons = (active) => ['hot', 'top']
  .map(key => 
    `<button class="sort-option ${active === key ? 'active' : ''}">${key}</button>`
  ).join('');

const redditSelect = (active) => {
  return `
    <select class="reddit-list">
      ${['all', 'ama', 'funny'].map(options(active)).join('')}
    </select>
  `;
}

const options = (active) => {
  return x => `<option value="${x}" ${x === active ? 'selected' : ''}>${x}</option>`
};

on('render', 'sort-options', ({target}) => {
  const active = props().sort
  target.innerHTML = sortButtons(active);
});

on('render', 'reddit-options', ({target}) => {
  const active = props().r
  target.innerHTML = redditSelect(active);
})

on('click', '.sort-option', ({target}) => {
  set('demo', {
    sort: target.innerText
  })
})

on('change', '.reddit-list', ({ target }) => {
  set('demo', {
    r: target.value
  })
})

let lastProps = null;

on('render', 'textarea', ({target}) => {
    target.value = code();
});

on('render', 'demoarea', ({target}) => {
  const currentProps = JSON.stringify(props())
  if(currentProps !== lastProps) {
    lastProps = currentProps;
    target.innerHTML = code();
  }
});

load('demo');
        </script>
      </details>

      <hr/>
      <p>
        <a href="./ion-tutorial-3.html">Last: Ion Tutorial 3</a>
      </p>
    </main>
  </body>
</html>

